ETAPAS Tech Lead

Fase 1: Fundação e "Hardening" (A Base)
Nesta fase, você configura o que o prompt chama de "binário autocontido".
1. Bootstrap de Infra: Criar estrutura de pastas (Clean Arch) e carregar configurações via Env/Viper.
2. Conectividade: Setup do pool de conexões GORM (pgx/mysql pure Go) com os limites de pool parametrizados.
3. Migrações: Implementar o sistema de migração embutido com go:embed.
4. Observabilidade: Configurar Logs estruturados e Middleware de Recovery no Echo v4.

Fase 2: Segurança e Identidade (O Porteiro)
Nenhum dado de estoque pode ser alterado sem rastro de quem o fez.
1. Domínio Identity: Criar tabelas de Usuários, Roles e Permissões.
2. Auth JWT: Implementar login e o middleware que extrai o ID do usuário e permissões do token.
3. Audit System: Criar a base para que todos os módulos registrem o created_by e updated_by.

Fase 3: Cadastro e Estrutura de Itens (Os Dados)
Definir o que o sistema gerencia.
1. Terceiros (ThirdParty): Cadastro de Fornecedores e Clientes.
2. Produtos e Serviços: Cadastro de itens com diferenciação entre estocável e hora-homem.
3. Preificação: Campos de Preço de Custo, Preço de Venda e Custo Médio (base para margem de lucro).

Fase 4: O Coração do Estoque (A Operação)
Aqui aplicamos as travas de segurança contra condições de corrida.
1. Warehouse & Bins: Definição física de onde os itens estão.
2. StockMovement com Lock: Implementar entradas e saídas usando SELECT FOR UPDATE.
3. StockLedger: Implementar o rastro imutável de toda movimentação (Auditoria).
4. Validações: Regras para impedir estoque negativo e alertas de estoque mínimo.

Fase 5: Engenharia e Produção (O Módulo BOM)
Agora o sistema é capaz de "transformar" produtos.
1. Estrutura de BOM: Criar a "receita" (Produto A = 2x Insumo B + 1h Serviço C).
2. Cálculo de Custo Preditivo: Função que soma os custos atuais dos insumos para sugerir o preço de venda.
3. Ordem de Produção: O processo que:
    * Trava os estoques dos insumos (SELECT FOR UPDATE).
    * Consome (subtrai) os insumos.
    * Gera (adiciona) o produto acabado.
    * Calcula a margem de lucro real baseada no custo efetivo do momento da produção.

Fase 6: Saída e Inteligência (Entrega de Valor)
O software pronto para o uso e análise.
1. Task Runner de Relatórios: Gerar PDFs de Faturas e Explosão de BOM via maroto em background.
2. Graceful Shutdown: Garantir que se o servidor cair durante uma produção de BOM, ele termine o processo ou faça rollback.
3. Dashboard de Margem: Tela final que compara: Preço de Venda - (Custo de Insumos + Impostos + Serviços) = Lucro Real.
